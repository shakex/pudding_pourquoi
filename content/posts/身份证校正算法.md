---
author: ["shake"]
title: "一种身份证件校正算法"
date: "2020-08-18"
# tags: ["quant", "fund"]
# categories: ["themes", "syntax"]
series: ["Computer Vision"]
ShowToc: true
TocOpen: false
---


> 主要功能：针对输入的身份证件图像进行透视变化校正，输出原分辨率大小的校正图像。
> 开发语言：Python
> 主要技术/框架：OpenCV、PyTorch

 
## 算法整体流程
 
算法流程：对于输入图像，经过四个模块处理，最终得到校正后的图像。四个模块分别为：边缘检测模块、直线检测模块、透视变换模块和后处理模块。四个主要模块的功能及主要实现方法如下：
- **边缘检测模块**：该模块的功能是通过图像得到身份证卡片的边缘。边缘图像用二值图表示，其中白色为前景（即身份证边缘轮廓），黑色为背景。算法采用两种方法进行边缘检测，第一种方法训练了一种边缘网络；第二种方法运用了基于Canny的边缘检测方法。在第一种方法无法检测得到卡片边缘的情况下（无法检测出全部四条直线边），将采用第二种方法。
- **直线检测模块**：该模块的功能是通过边缘二值图得到身份证卡片的四条直线边，从而进一步获得身份证四个角点的坐标。算法采用Hough直线变换，对于一次检测出来的多条直线，再选取符合度最高的四条直线边，两两求出其交点，即得到卡片的四个角点。
- **透视变换模块**：该模块的功能是通过身份证四个角点坐标，利用透视变换原理对图像进行透视校正，得到校正后图像。
- **后处理模块**：该模块的功能是校正后图像做进一步优化处理，如卡片倒角、旋转变换、长宽压缩等，最后输出符合要求的身份证图像。


## 边缘检测

### 边缘检测网络
边缘检测网络通过构建端到端的深度学习模型，将原始图像输入模型，直接得到卡片对应的边缘轮廓图像。该方法在算力、模型设计和数据选择的具体介绍如下：
 
- **算力**：采用Nvidia Geforce 2080 Ti进行GPU运算。
- **模型**：模型结构如上图所示。该模型是一种基于卷积神经网络（CNN），输入图像通过CNN骨干网络的编码器和基于循环解码单元（RDC）的解码器，生成最终的边缘检测结果。其中RDC是网络中用于层级特征融合的一种灵活的参数共享单元，其中运用了卷积循环神经网来融合不同尺度特征映射中的空间和语义信息。最终的分割结果由 RDC 解码的最后一层融合得分映射获得。 其中还创新地采用了一种基于加权交叉熵损失的边缘一致性损失函数，使得预测得到的边缘轮廓更加准确。
- **数据**：采用896张图片作为模型训练和测试数据。其中800张用于训练，96张用于模型测试。


### 基于Canny的边缘检测方法
该方法主要利用传统图像处理的方法进行边缘检测。对于一张输入图像，主要经历以下步骤：1. 图像灰度化；2. 图像闭运算；3. 空间平滑滤波；4. Canny边缘检测；5. 保留面积最大轮廓。每一步骤的效果示例图如下：

## 直线检测模块
主要利用Hough变换对边缘二值图像进行直线检测，在获取多条直线之后，利用每条直线的角度和位置属性进行筛选，选择最符合构成四边形的四条直线。最后计算两两直线的交点即得到卡片的四个角点坐标。

## 透视变换模块
根据四点透视变换原理，由四个关键点对图像进行透视变换，得到透视变换校正图像。在上一步种得到卡片四个角点以后，可直接调用python-opencv函数four_point_transform实现。

## 后处理模块
后处理主要包括以下处理：卡片倒角、旋转变换和长宽压缩。卡片倒角是根据二代身份证四角弧度对部分背景做透明化处理；旋转变换是由于输入图像可能本身存在旋转，因此在输出时需要根据透视变换校正以后图像的宽高比确定旋转的角度和方向；长宽压缩是对图像进一定的压缩使得输出图像符合标准二代身份证的长宽比例。

## 参考文献
[1] Wen, Ying, Kai Xie, and Lianghua He. "Segmenting Medical MRI via Recurrent Decoding Cell."  arXiv: Image and Video Processing (2019).  https://arxiv.org/abs/1911.09401